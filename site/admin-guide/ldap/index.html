<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon_ic.ico">

        <title>LDAP - Gluu Docs</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../.."><img src="../../img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../..">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../deployment/">Deployment</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../design-customizations/">Design and Customizations</a>
                                    </li>
                                
                            
                                
                                    <li class="active">
                                        <a href="./">LDAP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../uma/">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../personal/">Personal</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../faq/">FAQ</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../reference/api/">API</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/ldap-namespace/">LDAP Namespace</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/ldap-schema/">LDAP Schema</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/lib/">Gluu Library</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/oxAuth/">oxAuth</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/oxd/">OxD</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/oxTrust/">oxTrust</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../certificates/">Certificates</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../articles/apache-saml/">Apache-SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/benchmarking/">Benchmarking</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/custom-attributes/">Custom Attributes</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/iis-saml/">IIS SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/java-connect/">Java Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/js-connect/">JS Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/scim-client/">SCIM Client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/test-shib2/">Test Shib2</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../articles/gluu-server-ce/">Gluu Server CE</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../operations/">Gluu Server Operations</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../design-customizations/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../saml/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#ldap-configuration">LDAP Configuration</a></li>
        
       
    
       
        <li class="main "><a href="#indexing">Indexing</a></li>
        
            <li><a href="#opendj-indexing">OpenDJ Indexing</a></li>
        
            <li><a href="#389ds-indexing">389DS Indexing</a></li>
        
            <li><a href="#openldap-indexing">OpenLDAP Indexing</a></li>
        
            <li><a href="#configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</a></li>
        
            <li><a href="#oxauth-filters">oxAuth filters</a></li>
        
            <li><a href="#determining-what-needs-indexing">Determining what needs indexing</a></li>
        
            <li><a href="#sample-commands-to-add-indexes">Sample commands to add indexes</a></li>
        
       
    
       
        <li class="main "><a href="#replication">Replication</a></li>
        
            <li><a href="#opendj">OpenDJ</a></li>
        
            <li><a href="#openldap">OpenLDAP</a></li>
        
            <li><a href="#389ds">389DS</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<p><strong>Table of Contents</strong>  </p>
<ul>
<li><a href="#ldap-configuration">LDAP Configuration</a></li>
<li><a href="#indexing">Indexing</a><ul>
<li><a href="#opendj-indexing">OpenDJ Indexing</a></li>
<li><a href="#389ds-indexing">389DS Indexing</a></li>
<li><a href="#openldap-indexing">OpenLDAP Indexing</a></li>
<li><a href="#configuring-ldap-indexing-to-improve-ox-applications">Configuring LDAP indexing to improve OX applications performance</a></li>
<li><a href="#oxauth-filters">oxAuth filters</a></li>
<li><a href="#determining-what-needs-indexing">Determining what needs indexing</a></li>
<li><a href="#sample-commands-to-add-indexes">Sample commands to add indexes</a></li>
</ul>
</li>
<li><a href="#replication">Replication</a><ul>
<li><a href="#opendj">OpenDJ</a></li>
<li><a href="#openldap">OpenLDAP</a></li>
<li><a href="#389ds">389DS</a></li>
</ul>
</li>
</ul>
<h1 id="ldap-configuration">LDAP Configuration</h1>
<p>This section has information about how the Gluu Server uses LDAP, and other LDAP recommendations.</p>
<p>The Gluu Server uses LDAP for persistence to store information about things like configuration, user claims, and client claims. Currently Gluu ships with a forked version of OpenDJ. However, we hope to bolster support for OpenLDAP and 389DS. If you are an LDAP guru please help us by contributing documentation details!</p>
<h1 id="indexing">Indexing</h1>
<p>All databases need proper indexing to function. This is particularly true for LDAP servers. 
There should never be any <code>sub</code> or <code>one</code> scoped searches to the LDAP server that are not
properly indexed. Because indexing is implemenation specific, the following guidelines 
should provide a good starting point. The LDAP server logs should be periodically analyzed to
identify un-indexed searches. The exact indexing requirements may vary based on custom attributes,
and custom authentication and authorization requirements.</p>
<h2 id="opendj-indexing">OpenDJ Indexing</h2>
<p><a href="http://opendj.forgerock.org/opendj-server/doc/bootstrap/admin-guide/#chap-indexing">Indexing Attribute Values</a></p>
<h2 id="389ds-indexing">389DS Indexing</h2>
<p><a href="#">Indexing Architecture</a></p>
<h2 id="openldap-indexing">OpenLDAP Indexing</h2>
<p><a href="http://www.openldap.org/doc/admin24/tuning.html">OpenLDAP Tuning</a></p>
<p><strong>Recommended Indexes for OX</strong></p>
<p>Indexed attributes in OpenDS on seed.gluu.org server:</p>
<pre class="prettyprint well"><code>| cn               | equality, substring | default | 
| --               | ------------------- | ------- | 
| entryUUID        | equality            | default | 
| givenName        | equality, substring | default | 
| mail             | equality, substring | default | 
| member           | equality            | default | 
| sn               | equality, substring | default | 
| telephoneNumber  | equality, substring | default | 
| uid              | equality            | default | 
| uniqueMember     | equality            | default | 
| uniqueIdentifier | equality            | Gluu    | 
| inum             | equality            | Gluu    | 
| oxid             | equality            | Gluu    | 
| lastModifiedTime | ordering            | Gluu    | 
| oxAuthExpiration | ordering            | Gluu    |
</code></pre>
<p>For o=site cache refresh will search on the 'Primary Key'. So it will not be possible for us to know which attributes need to be indexed until configuration time.</p>
<h2 id="configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</h2>
<p>In order to keep optimal server load it's necessary to configure indexing for OpenDJ LDAP server. OpenDJ support these index types: approximate, equality, ordering, presence, substring, virtual list view, extensible matching rule. There is more information about index types in <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#indexes-overview">OpenDJ Admin Guide</a>. It's possible to add them for any LDAP attribute. OpenDJ will use them during searching result entries.</p>
<p>Default OpenDJ installation has few preconfigured indexes for these attributes: aci, cn, dn2id, ds-sync-conflict, ds-sync-hist, entryUUID, givenName, id2children, id2subtree, mail, member, objectClass, sn, telephone­Number, uid, unique­Member. This table contains definition of these indexes: <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#default-indexes">default Indexes</a>.</p>
<h2 id="oxauth-filters">oxAuth filters</h2>
<p>oxAuth has a few parts which allows custom LDAP filters:</p>
<pre class="prettyprint well"><code>`&lt;auth-filters-enabled&gt;`true`&lt;/auth-filters-enabled&gt;`
`&lt;auth-filters&gt;`
    `&lt;auth-filter&gt;`
        `&lt;!--filter&gt;`(&amp;amp;(associatedClient=*{0}*)(myPinCode={1}))`&lt;/filter--&gt;`
        `&lt;filter&gt;`(&amp;amp;(mail=*{0}*)(inum={1}))`&lt;/filter&gt;`
        `&lt;!-- If bind=true oxAuth should try to bind to entry which it found by filter specified above --&gt;`
        `&lt;bind&gt;`false`&lt;/bind&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`

    `&lt;auth-filter&gt;`
        `&lt;filter&gt;`uid={0}`&lt;/filter&gt;`
        `&lt;bind&gt;`true`&lt;/bind&gt;`
        `&lt;bind-password-attribute&gt;`pwd`&lt;/bind-password-attribute&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`
`&lt;/auth-filters&gt;`

`&lt;!-- Custom client filters to be able identify client by custom id. --&gt;`
`&lt;client-auth-filters-enabled&gt;`true`&lt;/client-auth-filters-enabled&gt;`
`&lt;client-auth-filters&gt;`
    `&lt;client-auth-filter&gt;`
        `&lt;filter&gt;`myCustomAttr1={0}`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter&gt;`
    `&lt;!--client-auth-filter&gt;`
        `&lt;filter&gt;`(&amp;amp;(myCustomAttr1={0})(myCustomAttr2={0}))`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter--&gt;`
`&lt;/client-auth-filters&gt;`
</code></pre>
<p>oxAuth uses them to find clients. Hence it's necessary to configure indexing for these filters. If there are no indexes for the filter attributes OpenDJ might use an unindexed search.</p>
<h2 id="determining-what-needs-indexing">Determining what needs indexing</h2>
<p>OpenDJ has built in functionality to help the admin find unindexed searches. More information about this is available in the OpenDJ Admin Guide <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#debug-search-indexes">Determining What Needs Indexing</a>.</p>
<h2 id="sample-commands-to-add-indexes">Sample commands to add indexes</h2>
<p>Add index for inum attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index inum
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt

./dsconfig create-local-db-index --backend-name inumDB --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name inumDB --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=site --index inum
./dsconfig set-backend-prop --backend-name inumDB --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for uniqueIdentifier attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name uniqueIdentifier --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index uniqueIdentifier
./rebuild-index --baseDN o=site --index uniqueIdentifier
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxId attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxId --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxId
./rebuild-index --baseDN o=site --index oxId
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for lastModifiedTime attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name lastModifiedTime --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index lastModifiedTime
./rebuild-index --baseDN o=site --index lastModifiedTime
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxAuthExpiration attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxAuthExpiration --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxAuthExpiration
./rebuild-index --baseDN o=site --index oxAuthExpiration
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Determine current status of indexes.</p>
<pre class="prettyprint well"><code>./dbtest list-index-status --backendID userRoot -b o=gluu
</code></pre>
<h1 id="replication">Replication</h1>
<p>The Gluu Server was designed to take advantage of LDAP replication. Each server has its 
own special configuration for replication. Below are some pointers to the respective platform's 
documentation on how to manage replication.</p>
<h2 id="opendj">OpenDJ</h2>
<p><a href="http://opendj.forgerock.org/opendj-server/doc/bootstrap/admin-guide/#chap-replication">Managing Replication - OpenDJ Admin Guide</a></p>
<h2 id="openldap">OpenLDAP</h2>
<p><a href="http://www.openldap.org/doc/admin24/replication.html">Replication</a></p>
<h2 id="389ds">389DS</h2>
<p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Administration_Guide/Managing_Replication.html">Managing Replication</a></p>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
        
    </body>
</html>
