<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>LDAP - Gluu Docs</title>
  

  <link rel="shortcut icon" href="../../img/gluu_favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Gluu Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
			
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Admin Guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../introduction/">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../deployment/">Deployment</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../certificates/">Certificates</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../design-customizations/">Design and Customizations</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">LDAP</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#ldap-configuration">LDAP Configuration</a></li>
                
            
                <li class="toctree-l3"><a href="#indexing">Indexing</a></li>
                
                    <li><a class="toctree-l4" href="#opendj-indexing">OpenDJ Indexing</a></li>
                
                    <li><a class="toctree-l4" href="#389ds-indexing">389DS Indexing</a></li>
                
                    <li><a class="toctree-l4" href="#openldap-indexing">OpenLDAP Indexing</a></li>
                
                    <li><a class="toctree-l4" href="#configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</a></li>
                
                    <li><a class="toctree-l4" href="#oxauth-filters">oxAuth filters</a></li>
                
                    <li><a class="toctree-l4" href="#determining-what-needs-indexing">Determining what needs indexing</a></li>
                
                    <li><a class="toctree-l4" href="#sample-commands-to-add-indexes">Sample commands to add indexes</a></li>
                
            
                <li class="toctree-l3"><a href="#replication">Replication</a></li>
                
                    <li><a class="toctree-l4" href="#opendj">OpenDJ</a></li>
                
                    <li><a class="toctree-l4" href="#openldap">OpenLDAP</a></li>
                
                    <li><a class="toctree-l4" href="#389ds">389DS</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../saml/">SAML</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../openid-connect/">OpenID Connect</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../uma/">UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../user-management/">User Management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../personal/">Personal</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../faq/">FAQ</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/api/">API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/interception-scripts/">Interception Scripts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/ldap-namespace/">LDAP Namespace</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/ldap-schema/">LDAP Schema</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/lib/">Gluu Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxAuth/">OxAuth</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxd/">OxD</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxTrust/">OxTrust</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/mod_auth_oidc/">Apache Module</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Articles</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/cache-refresh/">Cache Refresh Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/apache-saml/">Apache SAML SP Config</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/google-saml/">SAML SSO with Google</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/salesforce-sso/">SAML SSO with Salesforce</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/hobsons-saml/">SAML SSO with Hobsons</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/iis-saml/">IIS SAML Config</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/benchmarking/">Benchmarking</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/custom-attributes/">Custom Attributes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/gluu-server-ce/">Gluu CE</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/operations/">Gluu CE Operations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/java-connect/">OpenID in Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/js-connect/">OpenID from JavaScript</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/java-saml/">Java SAML Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/scim-client/">SCIM API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/mod-auth-oidc/">mod_auth_oidc Installation Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/test-shib2/">Testing Shib2</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../articles/social-login-google/">Social Login with Google</a>
        
    </li>

        
    </ul>
<li>
		
          
		
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Gluu Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Admin Guide &raquo;</li>
        
      
    
    <li>LDAP</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/GluuFederation/docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p><strong>Table of Contents</strong>  </p>
<ul>
<li><a href="#ldap-configuration">LDAP Configuration</a></li>
<li><a href="#indexing">Indexing</a><ul>
<li><a href="#opendj-indexing">OpenDJ Indexing</a></li>
<li><a href="#389ds-indexing">389DS Indexing</a></li>
<li><a href="#openldap-indexing">OpenLDAP Indexing</a></li>
<li><a href="#configuring-ldap-indexing-to-improve-ox-applications">Configuring LDAP indexing to improve OX applications performance</a></li>
<li><a href="#oxauth-filters">oxAuth filters</a></li>
<li><a href="#determining-what-needs-indexing">Determining what needs indexing</a></li>
<li><a href="#sample-commands-to-add-indexes">Sample commands to add indexes</a></li>
</ul>
</li>
<li><a href="#replication">Replication</a><ul>
<li><a href="#opendj">OpenDJ</a></li>
<li><a href="#openldap">OpenLDAP</a></li>
<li><a href="#389ds">389DS</a></li>
</ul>
</li>
</ul>
<h1 id="ldap-configuration">LDAP Configuration</h1>
<p>This section has information about how the Gluu Server uses LDAP, and other LDAP recommendations.</p>
<p>The Gluu Server uses LDAP for persistence to store information about things like configuration, user claims, and client claims. Currently Gluu ships with a forked version of OpenDJ. However, we hope to bolster support for OpenLDAP and 389DS. If you are an LDAP guru please help us by contributing documentation details!</p>
<h1 id="indexing">Indexing</h1>
<p>All databases need proper indexing to function. This is particularly true for LDAP servers. 
There should never be any <code>sub</code> or <code>one</code> scoped searches to the LDAP server that are not
properly indexed. Because indexing is implemenation specific, the following guidelines 
should provide a good starting point. The LDAP server logs should be periodically analyzed to
identify un-indexed searches. The exact indexing requirements may vary based on custom attributes,
and custom authentication and authorization requirements.</p>
<h2 id="opendj-indexing">OpenDJ Indexing</h2>
<p><a href="http://opendj.forgerock.org/opendj-server/doc/bootstrap/admin-guide/#chap-indexing">Indexing Attribute Values</a></p>
<h2 id="389ds-indexing">389DS Indexing</h2>
<p><a href="http://directory.fedoraproject.org/wiki/Database_Architecture#Indexing">Indexing Architecture</a></p>
<h2 id="openldap-indexing">OpenLDAP Indexing</h2>
<p><a href="http://www.openldap.org/doc/admin24/tuning.html">OpenLDAP Tuning</a></p>
<p><strong>Recommended Indexes for OX</strong></p>
<p>Indexed attributes in OpenDS on seed.gluu.org server:</p>
<pre><code>| cn               | equality, substring | default | 
| --               | ------------------- | ------- | 
| entryUUID        | equality            | default | 
| givenName        | equality, substring | default | 
| mail             | equality, substring | default | 
| member           | equality            | default | 
| sn               | equality, substring | default | 
| telephoneNumber  | equality, substring | default | 
| uid              | equality            | default | 
| uniqueMember     | equality            | default | 
| uniqueIdentifier | equality            | Gluu    | 
| inum             | equality            | Gluu    | 
| oxid             | equality            | Gluu    | 
| lastModifiedTime | ordering            | Gluu    | 
| oxAuthExpiration | ordering            | Gluu    |
</code></pre>
<p>For o=site cache refresh will search on the 'Primary Key'. So it will not be possible for us to know which attributes need to be indexed until configuration time.</p>
<h2 id="configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</h2>
<p>In order to keep optimal server load it's necessary to configure indexing for OpenDJ LDAP server. OpenDJ support these index types: approximate, equality, ordering, presence, substring, virtual list view, extensible matching rule. There is more information about index types in <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#indexes-overview">OpenDJ Admin Guide</a>. It's possible to add them for any LDAP attribute. OpenDJ will use them during searching result entries.</p>
<p>Default OpenDJ installation has few preconfigured indexes for these attributes: aci, cn, dn2id, ds-sync-conflict, ds-sync-hist, entryUUID, givenName, id2children, id2subtree, mail, member, objectClass, sn, telephone­Number, uid, unique­Member. This table contains definition of these indexes: <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#default-indexes">default Indexes</a>.</p>
<h2 id="oxauth-filters">oxAuth filters</h2>
<p>oxAuth has a few parts which allows custom LDAP filters:</p>
<pre><code>`&lt;auth-filters-enabled&gt;`true`&lt;/auth-filters-enabled&gt;`
`&lt;auth-filters&gt;`
    `&lt;auth-filter&gt;`
        `&lt;!--filter&gt;`(&amp;amp;(associatedClient=*{0}*)(myPinCode={1}))`&lt;/filter--&gt;`
        `&lt;filter&gt;`(&amp;amp;(mail=*{0}*)(inum={1}))`&lt;/filter&gt;`
        `&lt;!-- If bind=true oxAuth should try to bind to entry which it found by filter specified above --&gt;`
        `&lt;bind&gt;`false`&lt;/bind&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`

    `&lt;auth-filter&gt;`
        `&lt;filter&gt;`uid={0}`&lt;/filter&gt;`
        `&lt;bind&gt;`true`&lt;/bind&gt;`
        `&lt;bind-password-attribute&gt;`pwd`&lt;/bind-password-attribute&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`
`&lt;/auth-filters&gt;`

`&lt;!-- Custom client filters to be able identify client by custom id. --&gt;`
`&lt;client-auth-filters-enabled&gt;`true`&lt;/client-auth-filters-enabled&gt;`
`&lt;client-auth-filters&gt;`
    `&lt;client-auth-filter&gt;`
        `&lt;filter&gt;`myCustomAttr1={0}`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter&gt;`
    `&lt;!--client-auth-filter&gt;`
        `&lt;filter&gt;`(&amp;amp;(myCustomAttr1={0})(myCustomAttr2={0}))`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter--&gt;`
`&lt;/client-auth-filters&gt;`
</code></pre>
<p>oxAuth uses them to find clients. Hence it's necessary to configure indexing for these filters. If there are no indexes for the filter attributes OpenDJ might use an unindexed search.</p>
<h2 id="determining-what-needs-indexing">Determining what needs indexing</h2>
<p>OpenDJ has built in functionality to help the admin find unindexed searches. More information about this is available in the OpenDJ Admin Guide <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#debug-search-indexes">Determining What Needs Indexing</a>.</p>
<h2 id="sample-commands-to-add-indexes">Sample commands to add indexes</h2>
<p>Add index for inum attribute.</p>
<pre><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index inum
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt

./dsconfig create-local-db-index --backend-name inumDB --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name inumDB --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=site --index inum
./dsconfig set-backend-prop --backend-name inumDB --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for uniqueIdentifier attribute.</p>
<pre><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name uniqueIdentifier --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index uniqueIdentifier
./rebuild-index --baseDN o=site --index uniqueIdentifier
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxId attribute.</p>
<pre><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxId --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxId
./rebuild-index --baseDN o=site --index oxId
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for lastModifiedTime attribute.</p>
<pre><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name lastModifiedTime --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index lastModifiedTime
./rebuild-index --baseDN o=site --index lastModifiedTime
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxAuthExpiration attribute.</p>
<pre><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxAuthExpiration --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxAuthExpiration
./rebuild-index --baseDN o=site --index oxAuthExpiration
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Determine current status of indexes.</p>
<pre><code>./dbtest list-index-status --backendID userRoot -b o=gluu
</code></pre>
<h1 id="replication">Replication</h1>
<p>The Gluu Server was designed to take advantage of LDAP replication. Each server has its 
own special configuration for replication. Below are some pointers to the respective platform's 
documentation on how to manage replication.</p>
<h2 id="opendj">OpenDJ</h2>
<p><a href="http://opendj.forgerock.org/opendj-server/doc/bootstrap/admin-guide/#chap-replication">Managing Replication - OpenDJ Admin Guide</a></p>
<h2 id="openldap">OpenLDAP</h2>
<p><a href="http://www.openldap.org/doc/admin24/replication.html">Replication</a></p>
<h2 id="389ds">389DS</h2>
<p><a href="https://access.redhat.com/documentation/en-US/Red_Hat_Directory_Server/9.0/html/Administration_Guide/Managing_Replication.html">Managing Replication</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../saml/" class="btn btn-neutral float-right" title="SAML"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../design-customizations/" class="btn btn-neutral" title="Design and Customizations"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../design-customizations/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../saml/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
