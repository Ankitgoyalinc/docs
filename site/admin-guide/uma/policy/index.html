<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../..//img/favicon_ic.ico">

        <title>Uma - Gluu Servers</title>

        <link href="../../..//css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../..//css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../..//css/prettify-1.0.css" rel="stylesheet">
        <link href="../../..//css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../../"><img src="../../..//img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../../../">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../installation/">Installation</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../custom-look/">Customizing Look and Feel</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../certificates/">Certificates</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../authentication/">Authentication</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../oxPush/">oxPush</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../cluster/">GLUU Cluster</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../reference/configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/oxTrust/">oxTrust User Interface</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/ldap/">LDAP Schema</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/lib/">Libraries</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/api/">APIs</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../articles/gluu-server-ce/">Try Gluu Server CE - Quickstart</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/apache-saml/">Apache SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/apache-oauth2/">Apache OpenID Connect / UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/js-connect/">JavaScript OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-connect/">Java OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/scim-client/">Java SCIM client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/benchmarking/">Gluu Server Benchmark</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../resource-registration/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../uma-scopes/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#uma-policies">UMA Policies</a></li>
        
            <li><a href="#define-policy-in-oxtrust">Define policy in oxTrust</a></li>
        
            <li><a href="#algorithm">Algorithm</a></li>
        
            <li><a href="#policy-definition-in-ldap">Policy definition in LDAP</a></li>
        
            <li><a href="#interception-script-java-interface">Interception script Java interface</a></li>
        
            <li><a href="#sample-python">Sample (Python)</a></li>
        
            <li><a href="#sample-ldif-of-policy-ldap-entry">Sample LDIF of policy LDAP entry</a></li>
        
            <li><a href="#references">References</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="uma-policies">UMA Policies</h1>
<p>UMA Policy - object that protects UMA Resources. Protection of resources are made via scopes. Gluu server evaluates all policies (identified by scopes) in order to grant access.</p>
<p>UMA Policy main properties are:</p>
<ul>
<li>scopes - policy protects resources by scopes.</li>
<li>authorization script - script that is evaluated in order to grant or deny access (script basically returns true of false to server).</li>
<li>name - it's better to give good name to policy to understand what exactly it protects.</li>
</ul>
<h2 id="define-policy-in-oxtrust">Define policy in oxTrust</h2>
<p>There two ways to define UMA Policy for Gluu Server:</p>
<ul>
<li>Define via oxTrust (Gluu Server admin application)</li>
<li>Define in LDAP Server directly (advanced users only)</li>
</ul>
<p><img alt="Alt text" src="/img/uma/uma_oxtrust_policies.png" title="UMA Policies" /></p>
<p><img alt="Alt text" src="/img/uma/uma_oxtrust_policy_add.png" title="UMA Policy Add" /></p>
<h2 id="algorithm">Algorithm</h2>
<p>Rules:</p>
<ul>
<li>Policy protects resources based on scopes. If scope is protected by policy then during RPT authorization such policy script must return true in order to authorize access to resource, otherwise authorization is denied.</li>
<li>Scope can be protected by multiple policies. If one scope is protected by multiple policies then all policies must return true to authorize access. If at least one policy returned false then authorization is denied.
/sources/img/interception_scripts/uma_policy_handling.jpg
<img alt="Alt text" src="/img/interception_scripts/uma_policy_handling.jpg" title="UMA policy handling" /></li>
</ul>
<h2 id="policy-definition-in-ldap">Policy definition in LDAP</h2>
<p>Gluu Server uses LDAP for storing information, therefore here we consider Policy definition in LDAP format. Policy may contain authorization interception script coded in Python.</p>
<p>Language support:</p>
<ul>
<li>Python - supported</li>
<li>JavaScript - not supported (Right now we support only Python interception scripts however it's possible to plug-in any interpreter language, e.g. JS, please check Gluu Server release notes for more information).</li>
</ul>
<p>Policy entries location: ou=policies,ou=uma,o=<your organization id>,o=gluu (e.g. ou=policies,ou=uma,o=@!1111,o=gluu )</p>
<pre class="prettyprint well"><code>dn: inum=@!1111!0009!BC01!0000,ou=policies,ou=uma,o=@!1111,o=gluu
displayName: Only people from Austin can login
description: &lt;some description of the policy&gt;
oxPolicyScript: &lt;Python or JavaScript or whatever script code here&gt;
programmingLanguage: Python
inum: @!1111!0009!BC01!0000
oxAuthUmaScope: http://photoz.example.com/dev/scopes/view
oxAuthUmaScope: http://photoz.example.com/dev/scopes/all
objectClass: oxAuthUmaPolicy
objectClass: top
</code></pre>
<h2 id="interception-script-java-interface">Interception script Java interface</h2>
<pre class="prettyprint well"><code>public interface IPolicyExternalAuthorization {
    public boolean authorize(AuthorizationContext p_authorizationContext);
}

public interface IAuthorizationContext {
    String getClientClaim(String claimName);
    String getUserClaim(String claimName);
    String getRequestClaim(String claimName);
    String getUserClaimByLdapName(String ldapName);
    Integer getAuthLevel();
    String getAuthMode();
    String getIpAddress();
    boolean isInNetwork(String cidrNotation);
    RequesterPermissionToken getRPT();
    ResourceSetPermission getPermission();
    AuthorizationGrant getGrant(); // here return unmodifiable version of grant, e.g. to avoid new token creation
    HttpServletRequest getHttpRequest();
}
</code></pre>
<h2 id="sample-python">Sample (Python)</h2>
<p>Python sample authorization script (authorize only if user location claim equals to Austin)</p>
<pre class="prettyprint well"><code>from org.xdi.oxauth.service.uma.authorization import IPolicyExternalAuthorization
from org.xdi.util import StringHelper

class PythonExternalAuthorization(IPolicyExternalAuthorization):

    def authorize(self, authorizationContext):

        print "authorizing..."

        if StringHelper.equalsIgnoreCase(authorizationContext.getUserClaim("locality"), "Austin"):
            print "authorized"
            return True

        return False
</code></pre>
<h2 id="sample-ldif-of-policy-ldap-entry">Sample LDIF of policy LDAP entry</h2>
<pre class="prettyprint well"><code>dn: inum=@!1111!0008!B0DA.6413,ou=policies,ou=uma,o=@!1111,o=gluu
description: Sample policy
displayName: Sample policy
inum: @!1111!0008!B0DA.6413
objectClass: oxAuthUmaPolicy
objectClass: top
oxAuthUmaScope: http://photoz.example.com/dev/scopes/view
oxPolicyScript: from org.xdi.oxauth.service.uma.authorization import IPolicyExternalAuthorization
from org.xdi.util import StringHelper

class PythonExternalAuthorization(IPolicyExternalAuthorization):

    def authorize(self, authorizationContext):

        print "authorizing..."

        if StringHelper.equalsIgnoreCase(authorizationContext.getUserClaim("locality"), "Austin"):
            print "authorized"
            return True

        return False

programmingLanguage: python
</code></pre>
<h2 id="references">References</h2>
<ul>
<li><a href="http://kantarainitiative.org/confluence/display/uma/UMA+1.0+Core+Protocol">UMA Specifications</a></li>
<li><a href="https://svn.gluu.info/repository/openxdi/oxUmaDemo/RP/">UMA Requestion Party Sample implementation</a></li>
<li><a href="https://svn.gluu.info/repository/openxdi/oxUmaDemo/RS/">UMA Resource Server Sample implementation</a></li>
<li><a href="http://gluu.org">Gluu Server</a></li>
<li><a href="http://www.gluu.co/juju-draft-overview">Juju Application Security Framework (JASF) Overview</a></li>
</ul>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../..//js/bootstrap-3.0.3.min.js"></script>
        <script src="../../..//js/prettify-1.0.min.js"></script>
        <script src="../../..//js/base.js"></script>
        
    </body>
</html>