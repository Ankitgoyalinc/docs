<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../..//img/favicon_ic.ico">

        <title>Apache OpenID Connect / UMA - Gluu Servers</title>

        <link href="../..//css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../..//css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../..//css/prettify-1.0.css" rel="stylesheet">
        <link href="../..//css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../"><img src="../..//img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../../">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../admin-guide/introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/installation/">Installation</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/custom-look/">Customizing Look and Feel</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/certificates/">Certificates</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/authentication/">Authentication</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/uma/">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/oxPush/">oxPush</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/cluster/">GLUU Cluster</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../reference/configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/oxTrust/">oxTrust User Interface</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/ldap/">LDAP Schema</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/lib/">Libraries</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/api/">APIs</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../gluu-server-ce/">Try Gluu Server CE - Quickstart</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../apache-saml/">Apache SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li class="active">
                                        <a href="./">Apache OpenID Connect / UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../js-connect/">JavaScript OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../java-connect/">Java OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../scim-client/">Java SCIM client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../benchmarking/">Gluu Server Benchmark</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../google-saml/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../js-connect/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#apache-oauth2-using-mod_ox">Apache OAuth2 using mod_ox</a></li>
        
            <li><a href="#big-picture">Big picture</a></li>
        
            <li><a href="#installation">Installation</a></li>
        
            <li><a href="#test">Test</a></li>
        
            <li><a href="#environment-variables">Environment Variables</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="apache-oauth2-using-mod_ox">Apache OAuth2 using mod_ox</h1>
<p>mod_ox is an access control module implementing OIC+UMA and acts as Resource
Server side.</p>
<ul>
<li>OIC is implementing Implicit Flow of OpenID Connect specifications.</li>
<li>UMA is implementing an User-Managed Access (UMA)</li>
</ul>
<h2 id="big-picture">Big picture</h2>
<p>Solution consists of two parts:</p>
<ul>
<li>mod_ox - new apache module written in C which is loaded by httpd.</li>
<li>oxd - mediator between mod_ox and UMA Authorization server. oxd is java application.</li>
</ul>
<p>mod_ox defines set of custom directives for correct module configuration.</p>
<p>Communication between mod_ox and oxd is made via sockets on port 8099 (Port
should be configurable, 8099 should be used as default and fallback port).</p>
<p><img alt="Image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/openid_connect/oxd_overview.png?raw=true" /></p>
<h2 id="installation">Installation</h2>
<p>These docs assume that you have Apache2/HTTPD installed and running already. Both of
Linux and Windows are supported.</p>
<h3 id="prerequisites">Prerequisites</h3>
<ul>
<li><a href="http://memcached.org/">memcached</a> - An in-memory key-value store for small chunks of arbitrary data (strings, objects)</li>
<li>oxd - It's a mediator betweenApache plugins (mod_ox, mod_uma) and OIC/UMA Authorization server. If you are interested to know more, a full documentation is available <a href="http://ox.gluu.org/doku.php?id=oxd:home">here</a></li>
</ul>
<h3 id="source-collection">Source collection</h3>
<p><code>mod_ox</code> development release can be collected from Gluu SVN
<a href="https://svn.gluu.info/repository/oauth2ApacheHTTPD/MOD_OX/Package/mod_ox-0.1.tar.gz">link</a>. </p>
<p><em>Note that if you download a development release you will need current versions
of the autotools installed, and you must run ./autogen.sh first before following
these instructions.</em> </p>
<h4 id="compilation">Compilation</h4>
<ul>
<li>
<p>Untar the tarball</p>
</li>
<li>
<p>Enter into mod_ox directory and follow below commands to configure:</p>
<pre class="prettyprint well"><code>1. ./configure (./autogen.sh for development release)
2. make
3. sudo make install
</code></pre>
</li>
<li>
<p>Verify that the module has been enabled in your ”httpd.conf”:</p>
<pre class="prettyprint well"><code># note that the path to your module might be different
LoadModule ox_module /usr/lib/apache2/modules/mod_ox.so
</code></pre>
</li>
</ul>
<h4 id="parameter-configuration">Parameter configuration</h4>
<ul>
<li>
<p>Open up <code>ox.conf</code>. This is the main configuration file. Here is a sample configuration attached below with brief description. </p>
<pre class="prettyprint well"><code>&lt;DirectoryMatch "/ox"&gt;
    AuthType Gluu_ox
    Require valid-user

    # Connect|SAML
    AuthnType Connect

    # Valid only if AuthnType=Connect
    AmrValues https://schema.example.com/connect/basic

    # Valid only if AuthnType=SAML
    SAMLRedirectUrl http://www.myexample.com/secure/redirect.php

    # General
    OxdHostAddr 127.0.0.1
    OxdPortNum 8099
    MemcachedHostAddr 127.0.0.1
    MemcachedPortNum 11211
    ClientCredsPath /etc/myCLIENT/client_creds.json
    SendHeaders on

    # OpenID Connect Required - needed for both UMA and OpenID Connect
    ConnectDiscoveryUrl https://example.com/.well-known/openid-configuration
    ConnectRedirectUrl https://www.myexample.com/ox/redirect.html
    ClientName myCLIENT

    # UMA
    UmaDiscoveryUrl https://example.com/.well-known/uma-configuration
    UmaResourceName TestResource
    UmaRsHost www.myexample.com
    GETUmaAmHost idp.example.com "https://schema.example.com/uma/readPolicy1;https://schema.example.com/uma/readPolicy2"
    PUTUmaAmHost idp.example.com "https://schema.example.com/uma/write"
    POSTUmaAmHost idp.example.com "https://schema.example.com/uma/write"
    DELETEUmaAmHost idp.example.com "https://schema.example.com/uma/delete"

    # Logout
    ApplicationLogoutUrl http://www.myexample.com/ox/logout 
    ApplicationPostLogoutUrl https://idp.gluu.org/oxauth/seam/resource/restv1/oxauth/end_session
    ApplicationLogoutRedirectUrl http://www.myexample.com/ox/
&lt;/DirectoryMatch&gt;
</code></pre>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><em>Params</em></th>
<th>:</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><em>/ox</em></td>
<td>:</td>
<td>Apache directory protected by mod_ox plugin. Could be set any directory in Apache</td>
</tr>
<tr>
<td align="left"><em>AuthType</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Always must be “Gluu_ox”.</td>
</tr>
<tr>
<td align="left"><em>Require</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Always must be "valid-user"</td>
</tr>
<tr>
<td align="left"><em>AuthnType</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Always must be one of Connect and SAML</td>
</tr>
<tr>
<td align="left"><em>AcrValues</em></td>
<td>:</td>
<td>OPTIONAL. Requested Authentication Context Class Reference values</td>
</tr>
<tr>
<td align="left"><em>SAMLRedirectUrl</em></td>
<td>:</td>
<td>OPTIONAL. URL specifying Shibboleth SP apache module. (e.g. http://www.example.com/secure/redirect.php)</td>
</tr>
<tr>
<td align="left"><em>OxdHostAddr</em></td>
<td>:</td>
<td>OPTIONAL. Host Name or IP address of oxd server. This could be a host name or a IP address on a different host running oxd server. Default: (e.g. localhost or 127.0.0.1)</td>
</tr>
<tr>
<td align="left"><em>OxdPortNum</em></td>
<td>:</td>
<td>OPTIONAL. Port Number of oxd server. Default: (e.g. 8099)</td>
</tr>
<tr>
<td align="left"><em>MemcachedHostAddr</em></td>
<td>:</td>
<td>OPTIONAL. Host Name or IP address of memcached server. This could be a host name or a IP address on a different host running memcached server. If there is no Memcached, invalid. Default: (e.g. localhost or 127.0.0.1)</td>
</tr>
<tr>
<td align="left"><em>MemcachedPortNum</em></td>
<td>:</td>
<td>OPTIONAL. Port Number of memcached server. If there is no Memcached, invalid. Default: (e.g. 11211)</td>
</tr>
<tr>
<td align="left"><em>ClientCredsPath</em></td>
<td>:</td>
<td>OPTIONAL. Json file name to write user creds info on the file system. (e.g. /etc/myCLIENT/seed.gluu.org-client_creds.json)  In this case, /var/www/html/gluu/ should be writable. <code>sudo chmod 666 var/www/html/gluu/</code></td>
</tr>
<tr>
<td align="left"><em>SendHeaders</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Determine whether sending HTTP headers to oxAuth authorize requrest, or not (e.g. on</td>
</tr>
<tr>
<td align="left"><em>ConnectDiscoveryUrl</em></td>
<td>:</td>
<td>'REQUIRED`. URL specifying the Authorization Server discovery endpoint. (e.g. https://as.example.com/.well-known/openid-configuration) As UMA uses OpenID Connect for client registration, and mod_ox is always used for either UMA or OpenID Connect, there is no use case where the OpenID Connect URL is not needed.</td>
</tr>
<tr>
<td align="left"><em>ConnectRedirectUrl</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Redirection URL if authentication is succeed. Not really relevant for client authentication only, so if you are in doubt, just point it to the url of the folder you are protecting. This could be placed in any location, but recommended to be placed in the same directory protected by OX. (e.g. https://www.example.com/ox/ox_redirect.html)</td>
</tr>
<tr>
<td align="left"><em>ClientName</em></td>
<td>:</td>
<td><code>REQUIRED</code>. Client Name to be registered with the Authorization Server. Could be ANY name.</td>
</tr>
<tr>
<td align="left"><em>UmaDiscoveryUrl</em></td>
<td>:</td>
<td>OPTIONAL. URL specifying the UMA discovery endpoint. (e.g. https://as.example.com/.well-known/uma-configuration)</td>
</tr>
<tr>
<td align="left"><em>UmaResourceName</em></td>
<td>:</td>
<td>OPTIONAL. Resource name for UMA authentication. (e.g. TestResource). Could be any name.</td>
</tr>
<tr>
<td align="left"><em>UmaRsHost</em></td>
<td>:</td>
<td>OPTIONAL. Resource server (host where apache is loacated e.g. www.example.com)</td>
</tr>
<tr>
<td align="left"><em>GETUmaAmHost</em></td>
<td>:</td>
<td>OPTIONAL. Authorization server and scope for HTTP GET method (e.g. as.example.com "https://schema.example.com/uma/manager")</td>
</tr>
<tr>
<td align="left"><em>PUTUmaAmHost</em></td>
<td>:</td>
<td>OPTIONAL. Authorization server and scope for HTTP PUT method (e.g. as.example.com "https://schema.example.com/uma/manager")</td>
</tr>
<tr>
<td align="left"><em>POSTUmaAmHost</em></td>
<td>:</td>
<td>OPTIONAL. Authorization server and scope for HTTP POST method (e.g. as.example.com "https://schema.example.com/uma/manager")</td>
</tr>
<tr>
<td align="left"><em>DELETEUmaAmHost</em></td>
<td>:</td>
<td>OPTIONAL. Authorization server and scope for HTTP DELETE method (e.g. as.example.com "https://schema.example.com/uma/manager")</td>
</tr>
<tr>
<td align="left"><em>ClientCredsPath</em></td>
<td>:</td>
<td>File system location for client credentials. If blank, a new client will be created and save via Dynamic Client Registration. Sample format:</td>
</tr>
</tbody>
</table>
<pre class="prettyprint well"><code>    {
        "status": "ok",
        "data": {
            "client_id": "7fe914a5-6605-4372-9801-a78f8ac2d75b",
            "client_secret": "120fb4f5-ac08-494f-b94c-a2094e18f3c7",
            "registration_access_token": "86767689-ff3b-45d2-8dbc-6eabf329d3c0",
            "client_secret_expires_at": 1400920051
        }
    }
</code></pre>
<table>
<thead>
<tr>
<th align="left"><em>Params</em></th>
<th>:</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><em>ApplicationLogoutUrl</em></td>
<td>:</td>
<td>OPTIONAL. URL specifying openid logout. if the user hope to logout from openid authentification, just enter ApplicationLogoutUrl on web browser. Could be set any url in protected directory (e.g. http://www.myexample.com/ox/logout)</td>
</tr>
<tr>
<td align="left"><em>ApplicationPostLogoutUrl</em></td>
<td>:</td>
<td>OPTIONAL. URL specifying openid logout processing server. Redirected by mod_ox, if the user enter ApplicationLogoutUrl (e.g. https://idpdev.mediaocean.com/oxauth/seam/resource/restv1/oxauth/end_session)</td>
</tr>
<tr>
<td align="left"><em>ApplicationLogoutRedirectUrl</em></td>
<td>:</td>
<td>OPTIONAL. URL after logout. Could be set any url (e.g. http://www.myexample.com/ox)</td>
</tr>
</tbody>
</table>
<h4 id="further-configurations">Further Configurations</h4>
<ul>
<li>Copy <code>ox.conf</code> into Apache2/HTTPD directory.</li>
<li>Apply sufficient permission for <code>ox.conf</code> file.</li>
<li>Copy module in Apache2/HTTPD</li>
<li>Enabled mod in httpd.conf</li>
</ul>
<h2 id="test">Test</h2>
<ul>
<li>Start your <a href="http://ox.gluu.org/doku.php?id=oxd:home">oxd</a> server. </li>
<li>Restart Apache2/HTTPD</li>
<li>
<p>In the web browser, try with your hostname and mod_ox protected site. As for example, our sample hostname is "www.myapache.com" and we are protecting "ox" directory. So: </p>
<pre class="prettyprint well"><code>http://www.myapache.com/ox
</code></pre>
</li>
</ul>
<h2 id="environment-variables">Environment Variables</h2>
<table>
<thead>
<tr>
<th align="left"><em>Variable</em></th>
<th>:</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><em>OIC_SESSION_ID</em></td>
<td>:</td>
<td>Session id assigned to the session associated with the request.  i.e. PHP Environment Access : $_SERVER[“OIC_SESSION_ID”]</td>
</tr>
<tr>
<td align="left"><em>OIC_ID_TOKEN</em></td>
<td>:</td>
<td>ID token assigned to the session associated with the request. i.e. PHP Environment Access : $_SERVER[“OIC_SESSION_ID”]</td>
</tr>
<tr>
<td align="left"><em>OIC_ACCESS_TOKEN</em></td>
<td>:</td>
<td>Access token assigned to the session associated with the request. i.e. PHP Environment Access : $_SERVER[“OIC_ACCESS_TOKEN”]</td>
</tr>
<tr>
<td align="left"><em>OIC_SCOPE</em></td>
<td>:</td>
<td>OIC scope assigned to the session associated with the request. i.e. PHP Environment Access : $_SERVER[“OIC_SCOPE”]</td>
</tr>
<tr>
<td align="left"><em>OIC_STATE</em></td>
<td>:</td>
<td>Oic state assigned to the session associated with the request. i.e. PHP Environment Access : $_SERVER[“OIC_STATE”]</td>
</tr>
</tbody>
</table>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../..//js/bootstrap-3.0.3.min.js"></script>
        <script src="../..//js/prettify-1.0.min.js"></script>
        <script src="../..//js/base.js"></script>
        
    </body>
</html>