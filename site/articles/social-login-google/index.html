<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Social Login with Google - Gluu Docs</title>
  

  <link rel="shortcut icon" href="../../img/gluu_favicon.ico">
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Gluu Docs</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
			
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Admin Guide</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/introduction/">Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/getting-started/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/deployment/">Deployment</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/certificates/">Certificates</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/configuration/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/design-customizations/">Design and Customizations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/ldap/">LDAP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/saml/">SAML</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/openid-connect/">OpenID Connect</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/uma/">UMA</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/user-management/">User Management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/personal/">Personal</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../admin-guide/faq/">FAQ</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Reference</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/api/">API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/interception-scripts/">Interception Scripts</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/ldap-namespace/">LDAP Namespace</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/ldap-schema/">LDAP Schema</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/lib/">Gluu Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxAuth/">OxAuth</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxd/">OxD</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/oxTrust/">OxTrust</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../reference/mod_auth_oidc/">Apache Module</a>
        
    </li>

        
    </ul>
<li>
		
          
			
            <li>
    <ul class="subnav">
    <li><span>Articles</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../cache-refresh/">Cache Refresh Introduction</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../apache-saml/">Apache SAML SP Config</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../google-saml/">SAML SSO with Google</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../salesforce-sso/">SAML SSO with Salesforce</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../hobsons-saml/">SAML SSO with Hobsons</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../iis-saml/">IIS SAML Config</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../benchmarking/">Benchmarking</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../custom-attributes/">Custom Attributes</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../gluu-server-ce/">Gluu CE</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../operations/">Gluu CE Operations</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../java-connect/">OpenID in Java</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../js-connect/">OpenID from JavaScript</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../java-saml/">Java SAML Library</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../scim-client/">SCIM API</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../mod-auth-oidc/">mod_auth_oidc Installation Guide</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../test-shib2/">Testing Shib2</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Social Login with Google</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#social-login-with-google">Social Login with Google</a></li>
                
                    <li><a class="toctree-l4" href="#configure-google">Configure Google</a></li>
                
                    <li><a class="toctree-l4" href="#configure-gluu-server">Configure Gluu Server</a></li>
                
                    <li><a class="toctree-l4" href="#testing">Testing</a></li>
                
            
            </ul>
        
    </li>

        
    </ul>
<li>
		
          
		
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Gluu Docs</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Articles &raquo;</li>
        
      
    
    <li>Social Login with Google</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/GluuFederation/docs" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="social-login-with-google">Social Login with Google</h1>
<p>So you want to use Google for authentication? Its a nice option to offer to your customers
who may not want to maintain a password in your domain. Sometimes you may even want to let
employees use Google for authentication--everyone's got a Google account right?</p>
<p>Google is an external "identity provider" or IDP. You need to consider the situation that there
may be users who have Google credentials, but don't yet have an account in your domain. You have
two options: (1) don't let the users login; (2) dynamically add the users to your Gluu
Server LDAP server, which is what we call "dynamic enrollment."</p>
<p>Using a Gluu Server
<a href="../../reference/interception-scripts/">authentication interception script</a>,
you can implement any kind of business logic. Gluu has contributed an interception script to handle
Google login on
<a href="https://github.com/GluuFederation/oxAuth/blob/master/Server/integrations/gplus/GooglePlusExternalAuthenticator.py">Github</a>.
This article will provide step-by-step instructions on howto install and configure this script.</p>
<h2 id="configure-google">Configure Google</h2>
<p>In order to call Google API's, you need to register as a developer and create client credentials.
Here are some <a href="https://developers.google.com/identity/protocols/OAuth2">instructions</a></p>
<p>The first thing you'll need to do is Create a Project on Google to obtain
client credentials. Click "Create project" and enter project name</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/01-create-project.png" /></p>
<p>Then click on your newly created project from the listing on the dashboard, and under the Credentials section,
you'll need to create a new "OAuth2 2.0 client ID."</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/02-create-oauth2-creds.png" /></p>
<p>Google will ask you to configure your consent screen, to add your logo and other information displayed to the
user to authorize Google to release information.</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/03-create-oauth2-creds.png" /></p>
<p>Fill out the form...</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/04-configure-authorization-page.png" /></p>
<p>Now you're ready to create the credentials. Enter "Authorized JavaScript origins". It should be
the URL of your Gluu Server for example <code>https://idp.example.com</code></p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/05-create-oauth2-creds.png" /></p>
<p>Google will display the client-id and secret... ignore it. What you want to do is download the JSON which
you are going to upload into your Gluu Server.</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/06-download_json.png" /></p>
<p>Move this file to <code>/opt/tomcat/conf/google.json</code> The JSON will look something like this
(no... these aren't aren't valid creds!):</p>
<pre><code class="json">{
  &quot;web&quot;: {
    &quot;client_id&quot;: &quot;7a64e55f-724d4e8c91823d5f1f18a0b2.apps.googleusercontent.com&quot;,
    &quot;auth_uri&quot;: &quot;https:\/\/accounts.google.com\/o\/oauth2\/auth&quot;,
    &quot;token_uri&quot;: &quot;https:\/\/accounts.google.com\/o\/oauth2\/token&quot;,
    &quot;auth_provider_x509_cert_url&quot;: &quot;https:\/\/www.googleapis.com\/oauth2\/v1\/certs&quot;,
    &quot;client_secret&quot;: &quot;bb76a2c99be94e35b874&quot;,
    &quot;javascript_origins&quot;: [
      &quot;https:\/\/brookie.gluu.info&quot;
    ]
  }
}
</code></pre>

<p>The last step is to enable Google+ API's:
 - Navigate back to the Google API <a href="https://console.developers.google.com/project">console</a>
 - Select project and enter project name
 - Open new project "API &amp; auth -&gt; API" menu item in configuration navigation tree
 - Click "Google+ API"
 - Click "Enable API" button</p>
<h2 id="configure-gluu-server">Configure Gluu Server</h2>
<p>Login to oxTrust and navigate to "Configure Custom Scripts"</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/06-manage-custom-scripts.png" /></p>
<p>And at the bottom of the page, click on the little link for "Add custom script configuration"</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/07-add_custom_script.png" /></p>
<p>In the main body of the "Custom Script" section, paste the
<a href="https://raw.githubusercontent.com/GluuFederation/oxAuth/master/Server/integrations/gplus/GooglePlusExternalAuthenticator.py">code from github</a></p>
<p>You'll also need to add some custom properties:</p>
<ul>
<li><strong>gplus_client_secrets_file</strong> : /opt/tomcat/conf/google.json</li>
<li><strong>gplus_deployment_type</strong> : enroll</li>
<li><strong>gplus_remote_attributes_list</strong> : email, email, name, family_name, given_name, locale</li>
<li>
<p><strong>gplus_local_attributes_list</strong> : uid, mail, givenName, sn, cn, preferredLanguage</p>
</li>
<li>
<p><em>gplus_client_secrets_file</em> - It's mandatory property. It's path to application configuration file downloaded from Google console for application.
Example: <code>/etc/certs/gplus_client_secrets.json</code>
These are steps needed to get it:
    a) Log into: https://console.developers.google.com/project
    b) Click "Create project" and enter project name
    c) Open new project "API &amp; auth -&gt; Credentials" menu item in configuration navigation tree
    d) Click "Add credential" with type "OAuth 2.0 client ID"
    e) Select "Web application" application type
    f) Enter "Authorized JavaScript origins". It should be CE server DNS name. Example: https://gluu.info
    g) Click "Create" and Click "OK" in next dialog
    h) Click "Download JSON" in order to download gplus_client_secrets.json file
Also it's mandatory to enable Google+ API:
    a) Log into: https://console.developers.google.com/project
    b) Select project and enter project name
    c) Open new project "API &amp; auth -&gt; API" menu item in configuration navigation tree
    d) Click "Google+ API"
    e) Click "Enable API" button</p>
</li>
<li>
<p><em>gplus_deployment_type</em> - Specify deployment mode. It's optional property. If this property isn't specified script
   tries to find user in local LDAP by 'subject_identifier' claim specified in id_token. If this property has 'map' value script
   allow to map 'subject_identifier' to local user account. If this property has 'enroll' value script should add new user to local LDAP
   with status 'acrtive'. In order to map IDP attributes to local attributes it uses properties gplus_remote_attributes_list and
   gplus_local_attributes_list.
   Allowed values: map/enroll
   Example: enroll</p>
</li>
<li>
<p><em>gplus_remote_attributes_list</em> - Comma separated list of attribute names (user claims) that Google+
   returns which map to local attributes attributes in the <code>gplus_local_attributes_list</code> property.
   It's mandatory only if <code>gplus_deployment_type</code> is 'enroll'.</p>
</li>
<li>
<p><em>gplus_local_attributes_list</em> - Comma separated list of Gluu Server ldap attribute names
   returns are mapped to Google user claims from the <code>gplus_remote_attributes_list</code> property.
   It's mandatory only if <code>gplus_deployment_type</code> is 'enroll'.</p>
</li>
<li>
<p><em>extension_module</em> - Optional property to specify the full path of an external module that
implements two methods:</p>
</li>
</ul>
<pre><code class="python">    # This is called when the authentication script initializes
    def init(conf_attr):
        # Code here
        return True/False

    # This is called after authentication
    def postLogin(conf_attr, user):
        # Code here
        return True    # or return False
</code></pre>

<ol>
<li><em>gplus_client_configuration_attribute</em> - Optional property to specify client entry attribute name
    which can override <code>gplus_client_secrets_file file</code> content. It can be used in cases when all
    clients should use separate <code>gplus_client_secrets.json</code> configuration.</li>
</ol>
<h2 id="testing">Testing</h2>
<p>One simple way to test is to use oxTrust for testing. In the "Configure Authentication" menu dropdown, select
"Google" (or whatever you entered as the "Name" of the custom authentication script--as the default
authentication method.</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/08-select_default_authentication.png" /></p>
<p>After you login and logout, you should be presented with a new login form that has the Google Login button:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/09-google-authentication-button.png" /></p>
<p>After clicking the Google Login button, you should be presented for authorization--Google needs to make sure
its ok to release attributes to the Gluu Server:</p>
<p><img alt="image" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/google_login/10-google-authorization.png" /></p>
<p>If the script doesn't work, and you locked yourself out of oxTrust, don't worry! You can create an ldif file,
for example <code>revert.ldif</code>, to set back the default authentication method, like this:</p>
<pre><code>dn: inum=@!1E3B.F133.14FA.5062!0002!4B66.CF9C,ou=appliances,o=gluu
changetype: modify
replace: oxAuthenticationMode
oxAuthenticationMode: internal
</code></pre>
<p>oxAuthenticationMode corresponds to the 'Name' of the customer authentication script in oxTrust, use
<code>internal</code> to revert to the default ldap authentication. You'll have to change the <code>inum</code> with the <code>inum</code>
for your installation. You can find it an ldapsearch like this:</p>
<pre><code>/opt/opendj/bin/ldapsearch -h localhost -p 1389 -D "cn=directory manager" -j ~/.pw \
-b "ou=appliances,o=gluu" -s one "objectclass=*" inum
</code></pre>
<p>where <code>~/.pw</code> is a file with your Directory Manager password. If you don't remember it, try
    grep ldapPass= /install/community-edition-setup/setup.properties.last</p>
<p>Once your ldif looks ok, then use ldapmodify to revert back to password authentication:</p>
<pre><code>/opt/opendj/bin/ldapmodify -h localhost -p 1389 -D "cn=directory manager" -j ~/.pw -f revert.ldif
</code></pre>
<p>If things go wrong, it can leave the sessions in your browswer in a bad state. If things get really weird,
remove the cookies in your browser for the hostname of your Gluu Server.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../admin-guide/deployment/centos/" class="btn btn-neutral float-right" title="Centos"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../test-shib2/" class="btn btn-neutral" title="Testing Shib2"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../test-shib2/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../admin-guide/deployment/centos/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
