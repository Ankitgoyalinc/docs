<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon_ic.ico">

        <title>Apache SAML - Gluu Servers</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../.."><img src="../../img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../..">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../admin-guide/introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/installation/">Installation</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/oxTrust/">oxTrust User Interface</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/gluu-server-operations/">Gluu Server Operations</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/custom-look/">Customizing Look and Feel</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/registration/">Registration Workflow</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/certificates/">Certificates</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/authentication/">Authentication</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/uma/">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/oxPush/">oxPush</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../admin-guide/cluster/">HA Clusters</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../reference/configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/ldap/">LDAP Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/lib/">Libraries</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/oxd/">OXD</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../reference/api/">API</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                
                    
                        <li class="dropdown active">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../gluu-server-ce/">Try Gluu Server CE - Quickstart</a>
                                    </li>
                                
                            
                                
                                    <li class="active">
                                        <a href="./">Apache SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../js-connect/">JavaScript OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../java-connect/">Java OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../scim-client/">Java SCIM client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../benchmarking/">Gluu Server Benchmark</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../custom-attributes/">Adding Custom User Attributes</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../gluu-server-ce/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../java-saml/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#apache-saml">Apache SAML</a></li>
        
            <li><a href="#configuring-apache-shibboleth-sp-in-centos">Configuring Apache Shibboleth SP in CentOS</a></li>
        
            <li><a href="#configuring-apache-shibboleth-sp-in-ubuntu">Configuring Apache Shibboleth SP in Ubuntu</a></li>
        
            <li><a href="#configuring-apache-shibboleth-sp-in-windows">Configuring Apache Shibboleth SP in Windows</a></li>
        
            <li><a href="#shibboleth-sp-configuration-for-gluu-server-in-windows">Shibboleth SP Configuration for Gluu Server in Windows</a></li>
        
            <li><a href="#trust-relationship-in-idp">Trust Relationship in IdP</a></li>
        
            <li><a href="#shibboleth-sp-configuration_1">Shibboleth SP Configuration</a></li>
        
            <li><a href="#test-sso">Test SSO</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="apache-saml">Apache SAML</h1>
<h2 id="configuring-apache-shibboleth-sp-in-centos">Configuring Apache Shibboleth SP in CentOS</h2>
<h3 id="system-preparation">System preparation:</h3>
<ol>
<li>
<p>Add Shibboleth repo for CentOS6</p>
</li>
<li>
<p>Contents of "shib.repo":</p>
<pre class="prettyprint well"><code>[security_shibboleth]
name=Shibboleth (CentOS_CentOS-6)
type=rpm-md
baseurl=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/
gpgcheck=1
gpgkey=http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/repodata/repomd.xml.key
enabled=1
</code></pre>
</li>
<li>
<p>http://download.opensuse.org/repositories/security:/shibboleth/CentOS_CentOS-6/security:shibboleth.repo</p>
</li>
</ol>
<h3 id="shibboleth-sp-installation">Shibboleth SP installation</h3>
<ul>
<li>yum install shibboleth</li>
<li>service shibd start</li>
<li>chkconfig shibd on</li>
</ul>
<h3 id="install-and-configure-httpd">Install and Configure httpd</h3>
<h4 id="installation">Installation:</h4>
<ul>
<li>yum install httpd</li>
<li>service httpd start</li>
<li>Stop firewall</li>
</ul>
<h4 id="configuration">Configuration:</h4>
<ul>
<li>Change ServerName directive to the server name of SP</li>
<li>UseCanonicalName = On</li>
<li>Restart httpd</li>
</ul>
<h4 id="httpd-testing">Httpd testing:</h4>
<ul>
<li>Create a "index.html" inside /var/www/html</li>
<li>Restart httpd</li>
<li>Check from your browser</li>
</ul>
<h4 id="sp-key-cert">SP key cert</h4>
<ul>
<li>Create private key and certificate and place those in /etc/shibboleth</li>
<li>Change permission</li>
</ul>
<h3 id="shibboleth-sp-configuration">Shibboleth SP configuration:</h3>
<p>This section is mirroring how to configure "shibboleth2.xml" file. </p>
<ul>
<li>Provide "entityID" of SP in: <ul>
<li>&lt;ApplicationDefaults entityID="http://sp.example.org/Shibboleth" section</li>
</ul>
</li>
<li>Provide the "entityID of IDP" in: <ul>
<li>&lt;SSO entityID="https://idp.gluu.org/idp/shibboleth" section </li>
</ul>
</li>
<li>Point the metadata provider, in most cases it is Gluu IDP metadata link: <ul>
<li>&lt;MetadataProvider type="XML" uri="https://idp.gluu.org/idp/shibboleth" section</li>
</ul>
</li>
<li>Provide the key and cert of SP in: <ul>
<li>&lt;CredentialResolver type="File" key="spkey.key" certificate="spcrt.crt" section</li>
</ul>
</li>
</ul>
<h2 id="configuring-apache-shibboleth-sp-in-ubuntu">Configuring Apache Shibboleth SP in Ubuntu</h2>
<h3 id="system-preparation_1">System preparation:</h3>
<p>1.apt-get install curl</p>
<p>2.Grab Shibboleth repository from SWITCH:</p>
<ul>
<li>
<p>curl -k -O http://pkg.switch.ch/switchaai/SWITCHaai-swdistrib.asc</p>
</li>
<li>
<p>gpg --with-fingerprint  SWITCHaai-swdistrib.asc</p>
</li>
<li>
<p>apt-key add SWITCHaai-swdistrib.asc</p>
</li>
<li>
<p>echo 'deb http://pkg.switch.ch/switchaai/ubuntu precise main' | sudo tee /etc/apt/sources.list.d/SWITCHaai-swdistrib.list &gt; /dev/null</p>
</li>
<li>
<p>apt-get update</p>
</li>
</ul>
<h3 id="shibboleth-sp-installation_1">Shibboleth SP installation:</h3>
<ul>
<li>apt-get install shibboleth</li>
<li>Quick test:
<code>shibd -t  [ Important is the last line: overall configuration is loadable, check console for non-fatal problems ]</code></li>
</ul>
<h3 id="apache-testing">Apache testing:</h3>
<p><code>apache2ctl configtest</code></p>
<h3 id="test-shibboleth">Test Shibboleth:</h3>
<ul>
<li>https://hostname_of_sp/Shibboleth.sso/Session</li>
</ul>
<p><code>It will say: "A valid session was not found."</code></p>
<h3 id="shibboleth-manual-configuration-one-physical-sp">Shibboleth Manual configuration ( one Physical SP ):</h3>
<ul>
<li>Create a directory named "secure" under /var/www/</li>
<li>Change permission for directory "secure" to www-data:www-data</li>
<li>
<p>httpd.conf:</p>
<ul>
<li>ServerName <code>&lt;hostname_of_server&gt;</code></li>
<li>
<p>Set Location:</p>
<pre class="prettyprint well"><code>    &lt;Location /secure&gt;
        AuthType shibboleth
        ShibRequestSetting requireSession 1
        ShibUseHeaders on
        Require valid-user
    &lt;/Location&gt;
</code></pre>
</li>
</ul>
</li>
<li>
<p>shibboleth2.xml configuration:</p>
<ul>
<li>EntityID of SP: <code>ApplicationDefaults entityID="http://hostname/secure"</code></li>
<li>Provide EntityID of IDP: <code>SSO entityID="https://idp.gluu.org/idp/shibboleth"</code></li>
<li>Metadata Provider, IDP: <code>MetadataProvider type="XML" uri="https://idp.gluu.org/idp/shibboleth"</code></li>
</ul>
</li>
<li>
<p>Restart shibd and apache2</p>
</li>
<li>Create Trust Relationship for this SP in your desired IDP. </li>
</ul>
<h2 id="configuring-apache-shibboleth-sp-in-windows">Configuring Apache Shibboleth SP in Windows</h2>
<h3 id="shibboleth-sp-installation_2">Shibboleth SP Installation</h3>
<ul>
<li>Download the MSI of Shibboleth-SP from: http://www.shibboleth.net/downloads/service-provider/latest/</li>
<li>
<p>Start the installation</p>
</li>
<li>
<p>Destination folder (by default it is: C:\opt\shibboleth-sp). You can select any directory, but it is best to follow the tree \opt\shibboleth-sp\</p>
</li>
<li>Select Shibboleth Daemon port: default is 1600, you can keep it for local testing</li>
<li>Now, there are two options here. You have to follow either one (but not both) according to your target.<ul>
<li>Option 1: If you are installing Shibboleth for Apache Web server</li>
<li>Option 2: If you are installing Shibboleth for Microsoft IIS Web server</li>
<li>For Apache Web Server, UNCHECK “Install ISAPI filter and configure IIS”.</li>
<li>UAC of Windows 7 may block this program, so allow it</li>
</ul>
</li>
</ul>
<h3 id="apache-configuration">Apache configuration</h3>
<ul>
<li>Download the Apache HTTP server MSI Installer with OpenSSL: http://httpd.apache.org/download.cgi#apache22</li>
<li>Select Destination. You can keep the default destination for your local testing. But, make sure that there is no other “Apache Software Foundation” directory in your current “C:\Program Files\” location</li>
<li>Provide Server Information. For local testing, you can use “localdomain/localhost”</li>
<li>Test whether Apache is installed or not. Open your web browser and use “localhost”. If you see "It Works!" page, you are done.</li>
</ul>
<h3 id="shibboleth-and-apache-further-configuration">Shibboleth and Apache further configuration</h3>
<ul>
<li>Change the permission of the Apache Installation Directory, provide “write”  access </li>
<li>httpd.conf configuration<ul>
<li>Change: “ServerName localhost:80” ( for your local testing )</li>
<li>Copy apache22.conf from the Shibboleth directory to ~/apache/conf/extra/</li>
</ul>
</li>
<li>Shibboleth2.xml configuration<ul>
<li>Change: Host name=“localhost” ( for local testging )</li>
<li>Change: entityID=“https://localhost/shibboleth” ( for local testing )</li>
<li>Change: ApplicationOverride id=“admin” entityID=“https://localhost/shibboleth/”</li>
</ul>
</li>
<li>Reboot your Windows box</li>
</ul>
<h3 id="test-sp-installation-with-windows-and-apache">Test SP installation with Windows and Apache</h3>
<ul>
<li>Open Web browser and provide the address: localhost/Shibboleth.sso/Status</li>
<li>If you can see some XML page, you are done with your SP installation in Windows through Apache2</li>
</ul>
<h3 id="create-trust-relationship-from-gluu-idp">Create Trust Relationship from Gluu IDP</h3>
<p>How to create trust relationship with
<a href="http://www.gluu.org/docs/admin-guide/saml/outbound-saml/#saml-trust-relationship">Generate</a>
method.</p>
<h2 id="shibboleth-sp-configuration-for-gluu-server-in-windows">Shibboleth SP Configuration for Gluu Server in Windows</h2>
<h3 id="shibboleth-sp-installation_3">Shibboleth SP Installation</h3>
<ol>
<li>
<p>Download the <a href="http://shibboleth.net/downloads/service-provider/latest/">Shibboleth SP MSI</a>.</p>
</li>
<li>
<p>Start the installation.</p>
</li>
<li>
<p>Select the destination folder. The default destination is (C:\opt\shibboleth-sp) and it is recommended to use it although you can selet any other folder of your choice.
<img alt="Shibboleth SP Destination" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_destination.png" /></p>
</li>
<li>
<p>Select the Shibboleth Daemon Port: the default is <em>1600</em>. You can keep it for local testing.
<img alt="SP Port" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_port.png" /></p>
</li>
<li>
<p>There are two options to follow here and you can choose either one depending on your requirement.</p>
</li>
</ol>
<p>a. Option 1: If you are installing Shibboleth for Apache Web Server.</p>
<pre class="prettyprint well"><code>1. For Apache Web Server, **check "Install ISAPI filter and configure"**.
</code></pre>
<p><img alt="Apache Setup for IIS7" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_apachesetup.png" /></p>
<p>b. Option 2: If you are installing Shibboleth for Microsoft IIS Web Server.</p>
<pre class="prettyprint well"><code>1. For Microsoft IIS Web Server, **check "Install ISAPI filter and configure IIS"**. Please remember to put the file extension **".sso"**; this is necessary.
</code></pre>
<p><img alt="Microsoft IIS Server" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_microsoft.png" /></p>
<blockquote>
<p>UAC of Windows 7 may block this program, so allow it.<img alt="UAC" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_uac.png" /></p>
</blockquote>
<h3 id="apache-configuration_1">Apache Configuration</h3>
<ol>
<li>
<p>Download the <a href="http://httpd.apache.org/download.cgi#apache22">Apache HTTP Server MSI Installer</a> with OpenSSL.</p>
</li>
<li>
<p>Selet destination folder. The default destination folder can be kept for loal testing, but make sure there is no other "Apache Software Foundation" directory in your current "C:\Program Files\" location.
<img alt="Apache Destination" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_apachedestination.png" /></p>
</li>
<li>
<p>Provide Server Information. For local testing, you can use "localdomain/localhost".
<img alt="Server Information" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_serverinfo.png" /></p>
</li>
<li>
<p>Test whether Apache is installed or not. Open your web browser and use"localhost". If you see something that resembles the image below, you are done!
<img alt="Test" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_apachetest.png" /></p>
</li>
</ol>
<h3 id="shibboleth-and-apache-configuration">Shibboleth and Apache Configuration</h3>
<ol>
<li>
<p>Change the permission of Apache Installation Directory to provide "write" access.</p>
</li>
<li>
<p>httpd.conf configuration</p>
</li>
</ol>
<p>a. Change: "ServerName localhost:80" (for your local testing)</p>
<p>b. Copy <strong>apache22.conf</strong> from the <em>Shibboleth</em> directory <em>~/apache/conf/extra/</em></p>
<ol>
<li>Shibboleth2.xml configuration</li>
</ol>
<p>a. Change: Host name = "localhost" (for local testing)</p>
<p>b. Change: entityID = "https://localhost/shibboleth" (for local testing)</p>
<p>c. Change: ApplicationOverride id = "admin" entityID = "https://localhost/shibboleth/"</p>
<ol>
<li>Reboot your windows box.</li>
</ol>
<h4 id="test-sp-installation-with-windows-and-apache_1">Test SP Installation with Windows and Apache</h4>
<ol>
<li>
<p>Open the Web Browser and provide the address <em>localhost/Shibboleth.sso/Status</em> in the address bar.</p>
</li>
<li>
<p>If you can see an XML page like the one below, you have successfully installed the SP in Windows through Apache2.
<img alt="Apache Test" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/sp_setup/admin_sp_spapache.png" /></p>
</li>
</ol>
<h2 id="trust-relationship-in-idp">Trust Relationship in IdP</h2>
<ol>
<li>
<p>Log into the IdP as the administrator/admin user.</p>
</li>
<li>
<p>Select: SAML --&gt; Trust Relationship
<img alt="Trust Relationship" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/SAMLTrustRelationships/admin_saml_menu.png" /></p>
</li>
<li>
<p>Click "Add Relationship"</p>
</li>
<li>
<p>Configuration</p>
</li>
</ol>
<p>a. Display Name: No mandatory rule. Any name is fine.</p>
<p>b. Description: Description of this trust relationship.</p>
<p>c. Metadata Type: Select "Generate" from the drop-down menu.</p>
<p>d. URL: Hostname of the SP.</p>
<p>e. Public Certificate: Public certificate of Shibboleth SP site i.e. "sp-cert.pem" which was created during the Shibboleth SP Installation.</p>
<p>f. Attributes: Release required attributes from the left panel. Released attributes will be shown under the "New Trust Relationship" box.
<img alt="New TR" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/SAMLTrustRelationships/admin_saml_newTR.png" /></p>
<p>g. Click "Add"</p>
<p>h. After successful completion, a newtrust relationship will be shown in the Trust Relationship list.
<img alt="Trust Relationship Status" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/SAMLTrustRelationships/TR_status.png" /></p>
<ol>
<li>Collect configuration files for Shibboleth SP from Trust Relationship. This can be done by clicking on the "Download Shibboleth2 Configuration file" link.
<img alt="SP Config" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/oxTrust/admin_saml_newTR.png" /></li>
</ol>
<h2 id="shibboleth-sp-configuration_1">Shibboleth SP Configuration</h2>
<ol>
<li>There are four XML files in the Download Package; (i) attribute-map.xml (ii) idp-metadata.xml (iii) shibboleth2.xml and (iv) sp-metadata.xml. Place all the files inside the Shibboleth SP Configuration in the Shibboleth SP Server.</li>
</ol>
<p>a. Please make the required modification in the "shibboleth2.xml" file. A sample is given below.</p>
<p>b. Check permission of these files in the Shibboleth SP Server. For our testing server, we granted full access to Administrator and System.</p>
<p><img alt="Admin Grant" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/SAMLTrustRelationships/Admin_grant.png" />
<img alt="Permisison Grant" src="https://raw.githubusercontent.com/GluuFederation/docs/master/sources/img/SAMLTrustRelationships/Permission_grant.png" /></p>
<p>c. Restart Shibd Daemon and IIS.</p>
<h2 id="test-sso">Test SSO</h2>
<p>Insert the name of the SP site in the web browser and if the configurations are correct, then the SP will redirect the user to the IdP for authentication. After a successful authentication, the user will come back to the SP site as "logged-in user".</p>
<p>In one word: if the SP hostname is "https://testSPsite.com" and the IdP hostname is "https://testIdPsite.com" then the flow is</p>
<p>https://testSPsite.com --&gt; https://testIdPsite.com --&gt; htts://testSPsite.com as a logged-in user.</p>
<h3 id="sample-shibboleth2xml-file">Sample shibboleth2.xml file</h3>
<pre class="prettyprint well"><code>&lt;!-- This is a sample shibboleth2.xml file which will take place inside
Shibboleth-SP configuration. Please use this file as an example--&gt;

&lt;SPConfig xmlns="urn:mace:shibboleth:2.0:native:sp:config"
        xmlns:conf="urn:mace:shibboleth:2.0:native:sp:config"
        xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion"
        xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"    
        xmlns:md="urn:oasis:names:tc:SAML:2.0:metadata"
        logger="syslog.logger" clockSkew="180"&gt;

    &lt;!-- The OutOfProcess section contains properties affecting the shibd daemon. --&gt;
        &lt;OutOfProcess logger="shibd.logger"&gt;
        &lt;/OutOfProcess&gt;

    &lt;!-- The InProcess section conrains settings affecting web server modules/filters. --&gt;
        &lt;InProcess logger="native.logger"&gt;
        &lt;ISAPI normalizeRequest="true" safeHeaderNames="true"&gt;
                &lt;Site id="1" name="SP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS"/&gt;
        &lt;/ISAPI&gt;
        &lt;/InProcess&gt;

    &lt;!-- Only one listener can be defined, to connect in-process modules to shibd. --&gt;
        &lt;TCPListener address="127.0.0.1" port="1600" acl="127.0.0.1"/&gt;

        &lt;!-- This set of components stores sessions and other persistent data in daemon memory. --&gt;
        &lt;StorageService type="Memory" id="mem" cleanupInterval="900"/&gt;
        &lt;SessionCache type="StorageService" StorageService="mem" cacheTimeout="3600" inprocTimeout="900" cleanupInterval="900"/&gt;
        &lt;ReplayCache StorageService="mem"/&gt;
        &lt;ArtifactMap artifactTTL="180"/&gt;

    &lt;!-- To customize behavior, map hostnames and path components to applicationId and other settings. --&gt;
        &lt;RequestMapper type="Native"&gt;
        &lt;RequestMap applicationId="default"&gt;
                &lt;Host name="SP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS" authType="shibboleth" requireSession="true"/&gt;
        &lt;/RequestMap&gt;
        &lt;/RequestMapper&gt;

    &lt;!--
        The ApplicationDefaults element is where most of  SAML bits of Shibboleth are defined.
        Resource requests are mapped by the RequestMapper to an applicationId that
        points into to this section.
        --&gt;

    &lt;ApplicationDefaults id="default" policyId="default"
        entityID="DA.........XXXXX"
        REMOTE_USER="uid eppn persistent-id targeted-id mail"
        signing="false" encryption="false" attributePrefix="AJP_"&gt;

    &lt;!--
        Controls session lifetimes, address checks, cookie handling, and the protocol handlers.
        You MUST supply an effectively unique handlerURL value for each of your applications.
        The value can be a relative path, a URL with no hostname (https:///path) or a full URL.
        The system can compute a relative value based on the virtual host. Using handlerSSL="true"
        will force the protocol to be https. You should also add a cookieProps setting of "; path=/; secure"
        in that case. Note that while we default checkAddress to "false", this has a negative
        impact on the security of the SP. Stealing cookies/sessions is much easier with this disabled.
        --&gt;
    &lt;Sessions lifetime="28800" timeout="3600" checkAddress="false"
                handlerURL="https://SP_HOSTNAME/Shibboleth.sso" handlerSSL="true"
                exportLocation="https://SP_HOSTNAME/Shibboleth.sso/GetAssertion" exportACL="127.0.0.1"
                idpHistory="false" idpHistoryDays="7" cookieProps="; path=/; secure; httpOnly"&gt;

        &lt;!--
                SessionInitiators handle session requests and relay them to a Discovery page,
                or to an IdP if possible. Automatic session setup will use the default or first
                element (or requireSessionWith can specify a specific id to use).
                --&gt;

        &lt;!-- Default example directs to a specific SSO service of the IdP (favoring SAML 2 over Shib 1). --&gt;
        &lt;SessionInitiator type="Chaining" Location="/Login" isDefault="true" id="gluu"
             relayState="cookie" entityID="https://IDP_HOSTNAME/idp/shibboleth"&gt;
            &lt;SessionInitiator type="SAML2" acsIndex="1" template="bindingTemplate.html"/&gt;
                    &lt;SessionInitiator type="Shib1" acsIndex="5"/&gt;
        &lt;/SessionInitiator&gt;

        &lt;!--
                md:AssertionConsumerService locations handle specific SSO protocol bindings,
                such as SAML 2.0 POST or SAML 1.1 Artifact. The isDefault and index attributes
                are used when sessions are initiated to determine how to tell the IdP where and
                how to return the response.
                --&gt;
        &lt;md:AssertionConsumerService Location="/SAML2/POST" index="1"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
                &lt;md:AssertionConsumerService Location="/SAML2/POST-SimpleSign" index="2"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST-SimpleSign"/&gt;
                &lt;md:AssertionConsumerService Location="/SAML2/Artifact" index="3"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;
                &lt;md:AssertionConsumerService Location="/SAML2/ECP" index="4"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:PAOS"/&gt;
                &lt;md:AssertionConsumerService Location="/SAML/POST" index="5"
                    Binding="urn:oasis:names:tc:SAML:1.0:profiles:browser-post"/&gt;
                &lt;md:AssertionConsumerService Location="/SAML/Artifact" index="6"
                    Binding="urn:oasis:names:tc:SAML:1.0:profiles:artifact-01"/&gt;

        &lt;!-- LogoutInitiators enable SP-initiated local or global/single logout of sessions. --&gt;
                &lt;LogoutInitiator type="Chaining" Location="/Logout" relayState="cookie"&gt;
            &lt;LogoutInitiator type="SAML2" template="bindingTemplate.html"/&gt;
                    &lt;LogoutInitiator type="Local"/&gt;
        &lt;/LogoutInitiator&gt;

        &lt;!-- md:SingleLogoutService locations handle single logout (SLO) protocol messages. --&gt;
                &lt;md:SingleLogoutService Location="/SLO/SOAP"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;
                &lt;md:SingleLogoutService Location="/SLO/Redirect" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"/&gt;
                &lt;md:SingleLogoutService Location="/SLO/POST" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
                &lt;md:SingleLogoutService Location="/SLO/Artifact" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;


                &lt;!-- md:ManageNameIDService locations handle NameID management (NIM) protocol messages. --&gt;
                &lt;md:ManageNameIDService Location="/NIM/SOAP"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;
                &lt;md:ManageNameIDService Location="/NIM/Redirect" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"/&gt;
                &lt;md:ManageNameIDService Location="/NIM/POST" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"/&gt;
                &lt;md:ManageNameIDService Location="/NIM/Artifact" conf:template="bindingTemplate.html"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Artifact"/&gt;


                &lt;!--
                md:ArtifactResolutionService locations resolve artifacts issued when using the
                SAML 2.0 HTTP-Artifact binding on outgoing messages, generally uses SOAP.
                --&gt;
        &lt;md:ArtifactResolutionService Location="/Artifact/SOAP" index="1"
                    Binding="urn:oasis:names:tc:SAML:2.0:bindings:SOAP"/&gt;

        &lt;!-- Extension service that generates "approximate" metadata based on SP configuration. --&gt;
                &lt;Handler type="MetadataGenerator" Location="/Metadata" signing="false"/&gt;

        &lt;!-- Status reporting service. --&gt;
                &lt;Handler type="Status" Location="/Status" acl="127.0.0.1"/&gt;


                &lt;!-- Session diagnostic service. --&gt;
                &lt;Handler type="Session" Location="/Session" showAttributeValues="false"/&gt;

        &lt;/Sessions&gt;

            &lt;!--
            Allows overriding of error template filenames. You can also add attributes with values
            that can be plugged into the templates.
            --&gt;
        &lt;Errors supportContact="support@gluu.org"
                logoLocation="/shibboleth-sp/logo.jpg"
                styleSheet="/shibboleth-sp/main.css"/&gt;

        &lt;!-- Uncomment and modify to tweak settings for specific IdPs or groups. --&gt;
            &lt;RelyingParty Name="IDP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS" keyName="IDP_HOSTNAME_WITHOUT_HTTP_OR_HTTPS"/&gt;


            &lt;!-- Chains together all your metadata sources. --&gt;
            &lt;!-- Copy / Paste IdP generated metadata inside your SP configuration--&gt; 
            &lt;MetadataProvider type="Chaining"&gt;
                &lt;MetadataProvider type="XML" file="C:/opt/shibboleth-sp/etc/shibboleth/idp-metadata.xml"/&gt;
            &lt;/MetadataProvider&gt;

        &lt;!-- Chain the two built-in trust engines together. --&gt;
            &lt;TrustEngine type="Chaining"&gt;
                &lt;TrustEngine type="ExplicitKey"/&gt;
                &lt;TrustEngine type="PKIX"/&gt;
            &lt;/TrustEngine&gt;

        &lt;!-- Map to extract attributes from SAML assertions. --&gt;
            &lt;AttributeExtractor type="XML" validate="true" path="attribute-map.xml"/&gt;

        &lt;!-- Use a SAML query if no attributes are supplied during SSO. --&gt;
            &lt;AttributeResolver type="Query" subjectMatch="true"/&gt;

        &lt;!-- Default filtering policy for recognized attributes, lets other data pass. --&gt;
            &lt;AttributeFilter type="XML" validate="true" path="attribute-policy.xml"/&gt;

        &lt;!-- Simple file-based resolver for using a single keypair. --&gt;
            &lt;!-- &lt;CredentialResolver type="File" key="sp-key.pem" certificate="sp-cert.pem"/&gt; --&gt;

        &lt;!-- TODO is password needed? --&gt;
            &lt;!-- Location of your SP generated Private key and Public cert --&gt;
            &lt;!-- You need to use this Public cert when you create Trust Relationship in IdP--&gt;
            &lt;CredentialResolver type="File" key="C:/opt/shibboleth-sp/etc/shibboleth/sp_self.key"
                    certificate="C:/opt/shibboleth-sp/etc/shibboleth/sp_self.crt" /&gt;

    &lt;/ApplicationDefaults&gt;

    &lt;!-- Each policy defines a set of rules to use to secure messages. --&gt;
        &lt;SecurityPolicies&gt;
            &lt;!--
            The predefined policy enforces replay/freshness, standard
            condition processing, and permits signing and client TLS.
            --&gt;
        &lt;Policy id="default" validate="false"&gt;
            &lt;PolicyRule type="MessageFlow" checkReplay="true" expires="60"/&gt;
                    &lt;PolicyRule type="Conditions"&gt;
                    &lt;PolicyRule type="Audience"/&gt;
                    &lt;!-- Enable Delegation rule to permit delegated access. --&gt;
                    &lt;!-- &lt;PolicyRule type="Delegation"/&gt; --&gt;
            &lt;/PolicyRule&gt;
                        &lt;PolicyRule type="ClientCertAuth" errorFatal="true"/&gt;
                        &lt;PolicyRule type="XMLSigning" errorFatal="true"/&gt;
                    &lt;PolicyRule type="SimpleSigning" errorFatal="true"/&gt;
            &lt;/Policy&gt;
    &lt;/SecurityPolicies&gt;
&lt;/SPConfig&gt;
</code></pre>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
        
    </body>
</html>