<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon_ic.ico">

        <title>Interception scripts - Gluu Servers</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../.."><img src="../../../img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../../..">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../installation/">Installation</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../oxTrust/">oxTrust User Interface</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../gluu-server-operations/">Gluu Server Operations</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../custom-look/">Customizing Look and Feel</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../registration/">Registration Workflow</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../certificates/">Certificates</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../authentication/">Authentication</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../uma/">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../oxPush/">oxPush</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../cluster/">HA Clusters</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../reference/configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/ldap/">LDAP Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/lib/">Libraries</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/oxd/">OXD</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../reference/api/">API</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../articles/gluu-server-ce/">Try Gluu Server CE - Quickstart</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/apache-saml/">Apache SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/js-connect/">JavaScript OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-connect/">Java OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/scim-client/">Java SCIM client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/benchmarking/">Gluu Server Benchmark</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/custom-attributes/">Adding Custom User Attributes</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../post-registration/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../logout/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#pre-registration-script">Pre-Registration Script</a></li>
        
            <li><a href="#place-in-registration-workflow-and-sample-use-cases">Place in registration workflow and sample use cases.</a></li>
        
            <li><a href="#script-interface">Script interface</a></li>
        
            <li><a href="#script-example">Script example</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="pre-registration-script">Pre-Registration Script</h1>
<h2 id="place-in-registration-workflow-and-sample-use-cases">Place in registration workflow and sample use cases.</h2>
<p>Pre-Registration script is being executed after oxTrust gathered enough data about the user and before actually saving the user in either ACTIVE(User can use IDP) or INACTIVE(Administrator must activate user first) state. (Note that user may already exist in database as a result of Custom Authentication Script or Expiration).</p>
<p>Pre-Registration Script can be used to 
    ensure that new user is not a duplicate of an existing user (ensuring that email is unique for example), 
    interrupt registration of users with unacceptable attributes (for example age restrictions),
    make changes to database for specific user (deleting expired duplicates, creating custom groups o4r attributes, etc...)</p>
<h2 id="script-interface">Script interface</h2>
<p>Pre-Registration script implement a Registration Script interface:</p>
<pre class="prettyprint well"><code>package org.gluu.oxtrust.service.python.interfaces;

import java.util.List;

import org.gluu.oxtrust.model.GluuCustomPerson;
import org.xdi.model.SimpleCustomProperty;

/**
 * Base interface for registration python script
 *
 * @author Oleksiy Tataryn Date: 04.22.2014
 */
public interface RegistrationScript {
    public boolean execute(List&lt;SimpleCustomProperty&gt; list, GluuCustomPerson person);
}
</code></pre>

<p>Class name MUST be "RegistrationScriptClass"</p>
<h2 id="script-example">Script example</h2>
<p>This script verifies that specified attributes are unique and that email is not from a forbidden list of domains. 
It requires two attributes to be specified:
  * uniqueAttributes - comma-separated list of attributes. (mail,uid)
  * forbiddenDomains - comma-separated list of domains. (gmail.com,yahoo.com)</p>
<pre class="prettyprint well"><code>from org.gluu.oxtrust.service.python.interfaces import RegistrationScript
from org.gluu.oxtrust.ldap.service import PersonService
from org.gluu.oxtrust.model import User
from java.lang import String

import java

class RegistrationScriptClass(RegistrationScript):

    def __init__(self, currentTimeMillis):
        self.currentTimeMillis = currentTimeMillis

    def execute(self, configAttributes, registrationAttributes):
        print &quot;configAttributes&quot;
        print configAttributes
        print &quot;registrationAttributes&quot;
        print registrationAttributes
        customAttributes = registrationAttributes.getCustomAttributes()
        print &quot;customAttributes&quot;
        print customAttributes
        personService = PersonService.instance()

        for attribute in customAttributes:
            if(attribute.getName() == &quot;inum&quot; ):
                inumValue = attribute.getValues().pop(0)
                print &quot;InumValue &quot; + inumValue

        for configAttribute in configAttributes:
            if (configAttribute.getValue1() == &quot;uniqueAttributes&quot;):
                print &quot;uniqueAttributes present. Value = &quot; + configAttribute.getValue2()
                uniqueAttributes = String.split(configAttribute.getValue2(), &quot;,&quot;)
                for uniqueAttribute in uniqueAttributes:
                    print &quot;Checking if &quot; + uniqueAttribute + &quot; is Unique&quot;
                    for attribute in customAttributes:
                        if(attribute.getName() == uniqueAttribute):
                            attributeValue = attribute.getValues().pop(0)
                            print uniqueAttribute + &quot; value is &quot; + attributeValue
                            user = personService.getPersonByAttribute(attribute.getName(), attributeValue)
                            if(user != None and user.getInum() != inumValue):
                                print &quot;user &quot; + user.getInum() + &quot; contains duplicate attribute &quot; + attribute.getName() + &quot;:&quot; + attributeValue
                                return False
            if (configAttribute.getValue1() == &quot;forbiddenDomains&quot;):
                print &quot;forbiddenDomains present. Value = &quot; + configAttribute.getValue2()
                forbiddenDomains = String.split(configAttribute.getValue2(), &quot;,&quot;)
                for forbiddenDomain in forbiddenDomains:
                    for attribute in customAttributes:
                        if(attribute.getName() == &quot;mail&quot;):
                            if(attribute.getValues().pop(0).endswith(forbiddenDomain)):
                                print &quot;domain &quot; +  forbiddenDomain + &quot; is forbidden&quot;
                                return False

        return True
</code></pre>

</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/prettify-1.0.min.js"></script>
        <script src="../../../js/base.js"></script>
        
    </body>
</html>