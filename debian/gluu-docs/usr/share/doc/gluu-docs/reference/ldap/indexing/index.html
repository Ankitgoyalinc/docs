<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../../img/favicon_ic.ico">

        <title>Ldap - Gluu Servers</title>

        <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../../css/base.css" rel="stylesheet">
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->
            <a class="navbar-brand" href="../../.."><img src="../../../img/logo.png" ></a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    
                        <li >
                            <a href="../../..">Home</a>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Admin Guide <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/introduction/">Introduction</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/installation/">Installation</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/oxTrust/">oxTrust User Interface</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/gluu-server-operations/">Gluu Server Operations</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/custom-look/">Customizing Look and Feel</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/registration/">Registration Workflow</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/certificates/">Certificates</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/user-management/">User Management</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/authentication/">Authentication</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/saml/">SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/openid-connect/">OpenID Connect</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/uma/">UMA</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/oxPush/">oxPush</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../admin-guide/cluster/">HA Clusters</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../configuration/">Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../">LDAP Configuration</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../interception-scripts/">Interception Scripts</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../lib/">Libraries</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../oxd/">OXD</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../api/">API</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                
                    
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Articles <b class="caret"></b></a>
                            <ul class="dropdown-menu">
                            
                                
                                    <li >
                                        <a href="../../../articles/gluu-server-ce/">Try Gluu Server CE - Quickstart</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/apache-saml/">Apache SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-saml/">Java SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/google-saml/">Google SAML</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/js-connect/">JavaScript OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/java-connect/">Java OpenID Connect RP</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/scim-client/">Java SCIM client</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/benchmarking/">Gluu Server Benchmark</a>
                                    </li>
                                
                            
                                
                                    <li >
                                        <a href="../../../articles/custom-attributes/">Adding Custom User Attributes</a>
                                    </li>
                                
                            
                            </ul>
                        </li>
                    
                
                
                
                
                </ul>
            

            
            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../namespace/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../replication/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                
                <li>
                    <a href="https://github.com/GluuFederation/docs">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                <li>
                <!--<form action="." method="get" class="form-inline">-->
                    <!--<div class="search-box">-->
                        <!--<input type="text" value="" class="search-text" placeholder="Search" />-->
                        <!--<input type="submit" value="Search" class="search-tag"/>-->
                    <!--</div>-->
                <!--</form>-->

                </li>
                
            </ul>
            
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3">
                <div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
       
        <li class="main active"><a href="#indexing">Indexing</a></li>
        
            <li><a href="#opendj-indexing">OpenDJ Indexing</a></li>
        
            <li><a href="#389ds-indexing">389DS Indexing</a></li>
        
            <li><a href="#openldap-indexing-configuration">OpenLDAP Indexing configuration</a></li>
        
            <li><a href="#configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</a></li>
        
            <li><a href="#oxauth-filters">oxAuth filters</a></li>
        
            <li><a href="#determining-what-needs-indexing">Determining what needs indexing</a></li>
        
            <li><a href="#sample-commands-to-add-indexes">Sample commands to add indexes</a></li>
        
       
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="indexing">Indexing</h1>
<p>All databases need proper indexing to function. This is particularly true for LDAP servers. 
There should never be any <code>sub</code> or <code>one</code> scoped searches to the LDAP server that are not
properly indexed. Because indexing is implemenation specific, the following guidelines 
should provide a good starting point. The LDAP server logs should be periodically analyzed to
identify un-indexed searches. The exact indexing requirements may vary based on custom attributes,
and custom authentication and authorization requirements.</p>
<h2 id="opendj-indexing">OpenDJ Indexing</h2>
<p><a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/index/chap-indexing.html">Indexing Attribute Values</a></p>
<h2 id="389ds-indexing">389DS Indexing</h2>
<p><a href="http://directory.fedoraproject.org/wiki/Database_Architecture#Indexing">Indexing Architecture</a></p>
<h2 id="openldap-indexing-configuration">OpenLDAP Indexing configuration</h2>
<p><a href="http://www.openldap.org/doc/admin24/tuning.html">OpenLDAP Tuning</a></p>
<p><strong>Recommended Indexes for OX</strong></p>
<p>Indexed attributes in opends on seed.gluu.org server:</p>
<table>
<thead>
<tr>
<th>cn</th>
<th>equality, substring</th>
<th>default</th>
</tr>
</thead>
<tbody>
<tr>
<td>entryUUID</td>
<td>equality</td>
<td>default</td>
</tr>
<tr>
<td>givenName</td>
<td>equality, substring</td>
<td>default</td>
</tr>
<tr>
<td>mail</td>
<td>equality, substring</td>
<td>default</td>
</tr>
<tr>
<td>member</td>
<td>equality</td>
<td>default</td>
</tr>
<tr>
<td>sn</td>
<td>equality, substring</td>
<td>default</td>
</tr>
<tr>
<td>telephoneNumber</td>
<td>equality, substring</td>
<td>default</td>
</tr>
<tr>
<td>uid</td>
<td>equality</td>
<td>default</td>
</tr>
<tr>
<td>uniqueMember</td>
<td>equality</td>
<td>default</td>
</tr>
<tr>
<td>uniqueIdentifier</td>
<td>equality</td>
<td>Gluu</td>
</tr>
<tr>
<td>inum</td>
<td>equality</td>
<td>Gluu</td>
</tr>
<tr>
<td>oxid</td>
<td>equality</td>
<td>Gluu</td>
</tr>
<tr>
<td>lastModifiedTime</td>
<td>ordering</td>
<td>Gluu</td>
</tr>
<tr>
<td>oxAuthExpiration</td>
<td>ordering</td>
<td>Gluu</td>
</tr>
</tbody>
</table>
<p>For o=site cache refresh will search on the 'Primary Key'. So it will not be possible for us to know which attributes need to be indexed until configuration time.</p>
<h2 id="configuring-ldap-indexing-to-improve-ox-applications-performance">Configuring LDAP indexing to improve OX applications performance</h2>
<p>In order to keep optimal server load it's necessary to configure indexing for OpenDJ LDAP server. OpenDJ support these index types: approximate, equality, ordering, presence, substring, virtual list view, extensible matching rule. There is more information about index types in <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#indexes-overview">OpenDJ Admin Guide</a>. It's possible to add them for any LDAP attribute. OpenDJ will use them during searching result entries.</p>
<p>Default OpenDJ installation has few preconfigured indexes for these attributes: aci, cn, dn2id, ds-sync-conflict, ds-sync-hist, entryUUID, givenName, id2children, id2subtree, mail, member, objectClass, sn, telephone­Number, uid, unique­Member. This table contains definition of these indexes: <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#default-indexes">default Indexes</a>.</p>
<h2 id="oxauth-filters">oxAuth filters</h2>
<p>oxAuth has few parts which allows to specify custom LDAP filters:</p>
<pre class="prettyprint well"><code>`&lt;auth-filters-enabled&gt;`true`&lt;/auth-filters-enabled&gt;`
`&lt;auth-filters&gt;`
    `&lt;auth-filter&gt;`
        `&lt;!--filter&gt;`(&amp;amp;(associatedClient=*{0}*)(myPinCode={1}))`&lt;/filter--&gt;`
        `&lt;filter&gt;`(&amp;amp;(mail=*{0}*)(inum={1}))`&lt;/filter&gt;`
        `&lt;!-- If bind=true oxAuth should try to bind to entry which it found by filter specified above --&gt;`
        `&lt;bind&gt;`false`&lt;/bind&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`

    `&lt;auth-filter&gt;`
        `&lt;filter&gt;`uid={0}`&lt;/filter&gt;`
        `&lt;bind&gt;`true`&lt;/bind&gt;`
        `&lt;bind-password-attribute&gt;`pwd`&lt;/bind-password-attribute&gt;`
        `&lt;base-dn&gt;`o=gluu`&lt;/base-dn&gt;`
    `&lt;/auth-filter&gt;`
`&lt;/auth-filters&gt;`

`&lt;!-- Custom client filters to be able identify client by custom id. --&gt;`
`&lt;client-auth-filters-enabled&gt;`true`&lt;/client-auth-filters-enabled&gt;`
`&lt;client-auth-filters&gt;`
    `&lt;client-auth-filter&gt;`
        `&lt;filter&gt;`myCustomAttr1={0}`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter&gt;`
    `&lt;!--client-auth-filter&gt;`
        `&lt;filter&gt;`(&amp;amp;(myCustomAttr1={0})(myCustomAttr2={0}))`&lt;/filter&gt;`
        `&lt;base-dn&gt;`ou=clients,o=@!1111,o=gluu`&lt;/base-dn&gt;`
    `&lt;/client-auth-filter--&gt;`
`&lt;/client-auth-filters&gt;`
</code></pre>
<p>oxAuth uses them to find clients. Hence it's necessary to configure indexing for these filters. Without them OpenDJ might use unindexed search if there are no indexes for these filter's attributes.</p>
<h2 id="determining-what-needs-indexing">Determining what needs indexing</h2>
<p>OpenDJ has built in functionality which allows to find unindexed searches. More information about this part is available in OpenDJ Admin Guide <a href="http://opendj.forgerock.org/opendj-server/doc/admin-guide/#debug-search-indexes">Determining What Needs Indexing</a>.</p>
<h2 id="sample-commands-to-add-indexes">Sample commands to add indexes</h2>
<p>Add index for inum attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index inum
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt

./dsconfig create-local-db-index --backend-name inumDB --type generic --index-name inum --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name inumDB --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=site --index inum
./dsconfig set-backend-prop --backend-name inumDB --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for uniqueIdentifier attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name uniqueIdentifier --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index uniqueIdentifier
./rebuild-index --baseDN o=site --index uniqueIdentifier
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxId attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxId --set index-type:equality --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxId
./rebuild-index --baseDN o=site --index oxId
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for lastModifiedTime attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name lastModifiedTime --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index lastModifiedTime
./rebuild-index --baseDN o=site --index lastModifiedTime
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Add index for oxAuthExpiration attribute.</p>
<pre class="prettyprint well"><code>./dsconfig create-local-db-index --backend-name userRoot --type generic --index-name oxAuthExpiration --set index-type:ordering --set index-entry-limit:4000 --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./dsconfig set-backend-prop --backend-name userRoot --set enabled:false --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
./rebuild-index --baseDN o=gluu --index oxAuthExpiration
./rebuild-index --baseDN o=site --index oxAuthExpiration
./dsconfig set-backend-prop --backend-name userRoot --set enabled:true --hostName host --port 4444 --bindDN cn=Directory\ Manager -j /tmp/.pw --trustAll --noPropertiesFile --no-prompt
</code></pre>
<p>Determine current status of indexes.</p>
<pre class="prettyprint well"><code>./dbtest list-index-status --backendID userRoot -b o=gluu
</code></pre>
</div>
        </div>

        <footer class="col-md-12">
            <hr>
            
            <p>Copyright &copy; 2014, Gluu, Inc.</p>
            
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../../js/prettify-1.0.min.js"></script>
        <script src="../../../js/base.js"></script>
        
    </body>
</html>